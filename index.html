<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ルレット</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #result {
      height: 80px;
      font-size: 28px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #container {
      position: relative;
      margin-top: 40px;
    }

    #arrow {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 32px;
    }

    #roulette {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      border: 8px solid #fff;
      background: conic-gradient(
        #2ecc71 0deg 108deg,
        #e74c3c 108deg 216deg,
        #f1c40f 216deg 360deg
      );
      transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
    }

    button {
      margin-top: 30px;
      padding: 12px 28px;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <!-- 結果表示（上） -->
  <div id="result">START</div>

  <!-- ルーレット -->
  <div id="container">
    <div id="arrow">▼</div>
    <div id="roulette"></div>
  </div>

  <button onclick="spin()">回す</button>

  <!-- 効果音 -->
  <audio id="se-spin" src="https://soundeffect-lab.info/sound/anime/mp3/timpani-roll1.mp3"></audio>
  <audio id="se-hit" src="https://soundeffect-lab.info/sound/anime/mp3/pafu_pafu1.mp3"></audio>

  <script>
    const roulette = document.getElementById("roulette");
    const result = document.getElementById("result");
    const seSpin = document.getElementById("se-spin");
    const seHit = document.getElementById("se-hit");

    let spinning = false;
    let currentRotation = 0;

    function spin() {
      if (spinning) return;
      spinning = true;

      result.textContent = "回転中…";

      seSpin.currentTime = 0;
      seSpin.loop = true;
      seSpin.play();

      // 判定（SAFE 30%）
      const rand = Math.random();
      let outcome;
      if (rand < 0.3) {
        outcome = "SAFE";
      } else if (rand < 0.65) {
        outcome = "EVENT A";
      } else {
        outcome = "EVENT B";
      }

      // 回転角度
      const baseSpin = 360 * 5;
      let offset;
      if (outcome === "SAFE") offset = 30;
      else if (outcome === "EVENT A") offset = 150;
      else offset = 270;

      currentRotation += baseSpin + offset;
      roulette.style.transform = `rotate(${currentRotation}deg)`;

      setTimeout(() => {
        seSpin.pause();
        seSpin.currentTime = 0;

        seHit.currentTime = 0;
        seHit.loop = true;
        seHit.play();

        result.textContent = outcome;

        // 5秒後に全部リセット
        setTimeout(() => {
          seHit.pause();
          seHit.currentTime = 0;

          roulette.style.transform = "rotate(0deg)";
          currentRotation = 0;
          result.textContent = "START";
          spinning = false;
        }, 5000);

      }, 4000);
    }
  </script>
</body>
</html>
