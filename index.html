<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈÅãÂëΩ„ÅÆ„É´„Éº„É¨„ÉÉ„Éà„Éª„Ç¢„É´„ÉÜ„Ç£„É°„ÉÉ„Éà EX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        :root {
            --bg-grad: linear-gradient(to bottom, #ffffff 0%, #f0f2f5 100%);
            --text-color: #333; --p-blue: #bae1ff; --p-red: #ffb3ba; --mint-active: #b2ffb2;
        }
        * { box-sizing: border-box; }
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            margin: 0; padding: 0; background: var(--bg-grad); color: var(--text-color);
            overflow: hidden; height: 100vh; display: flex; justify-content: center; align-items: center;
        }
        #bgCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .container { display: grid; grid-template-columns: 240px 1fr 240px; gap: 40px; width: 95%; max-width: 1300px; height: 85vh; position: relative; z-index: 1; }
        .audio-box { border: 1px solid #ddd; padding: 15px; border-radius: 15px; background: rgba(255, 255, 255, 0.9); text-align: center; }
        .vol-game { position: relative; height: 70px; border-bottom: 3px solid #ccc; margin-bottom: 10px; background: #fff; border-radius: 5px; overflow: hidden; }
        #volBall { width: 18px; height: 18px; background: #ff6b6b; border-radius: 50%; position: absolute; top: 0; left: 50%; display: none; }
        .tabs { display: flex; flex-direction: column; gap: 8px; }
        .tab-item { padding: 12px; border: 1px solid #eee; background: white; cursor: pointer; border-radius: 10px; display: flex; justify-content: space-between; font-size: 13px; }
        .tab-item.active { background-color: var(--mint-active); font-weight: bold; transform: scale(1.05); }
        .sys-btns { display: flex; flex-direction: column; gap: 8px; }
        button { padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .center-panel { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .res-display { font-size: 32px; font-weight: bold; margin-bottom: 15px; height: 45px; text-align: center; }
        .r-wrap { position: relative; margin-bottom: 20px; }
        .needle { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 40px; z-index: 10; color: #ff4444; }
        canvas#rCvs { border-radius: 50%; box-shadow: 0 10px 40px rgba(0,0,0,0.15); background: white; }
        #spinBtn { width: 220px; height: 60px; font-size: 24px; background: #66cc66; color: white; border-bottom: 5px solid #44aa44; margin-bottom: 15px; }
        textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 10px; resize: none; background: rgba(255,255,255,0.85); }
        .hist-card { border: 1px solid #eee; border-radius: 20px; padding: 15px; height: 70%; background: rgba(255, 255, 255, 0.9); }
        .hist-list { list-style: none; padding: 0; overflow-y: auto; height: 90%; text-align: center; font-size: 14px; }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="container">
    <div class="left-panel">
        <div class="audio-box">
            <div style="font-size:11px; color:#888;">VOL: <span id="volText">50%</span></div>
            <div class="vol-game"><div id="volBall"></div></div>
            <button onclick="dropBall()" style="background:#f0f0f0; width:100%;">üîä Èü≥ÈáèÊäΩÈÅ∏</button>
        </div>
        <div class="tabs" id="tabs"></div>
        <div class="sys-btns">
            <button onclick="copyCompressedUrl()" style="background:var(--p-blue)">üîó ‰øùÂ≠ò„ÉªURL„Ç≥„Éî„Éº</button>
            <button onclick="hardReset()" style="background:var(--p-red)">‚ö†Ô∏è „É™„Çª„ÉÉ„Éà</button>
        </div>
    </div>

    <div class="center-panel">
        <div class="res-display" id="resText">READY</div>
        <div class="r-wrap">
            <div class="needle">‚ñº</div>
            <canvas id="rCvs" width="380" height="380"></canvas>
        </div>
        <button id="spinBtn" onclick="spin()">START</button>
        <textarea id="itemsArea" placeholder="È†ÖÁõÆ„ÇíÊîπË°å„ÅßÂÖ•Âäõ..."></textarea>
    </div>

    <div class="right-panel">
        <div class="hist-card">
            <div style="text-align:center; font-size:12px; color:#888;">HISTORY</div>
            <ul class="hist-list" id="histUl"></ul>
        </div>
    </div>
</div>

<script>
const COLORS = ['#ffb3ba', '#ffffba', '#ffdfba', '#bae1ff', '#e2baff', '#baffc9', '#ffccf9'];
let items = [], hist = [], spinning = false;
let tabs = [ { name: "„Çø„Éñ 1", content: "ÁÑºËÇâ\nÂØøÂè∏\n„ÅÜ„Å©„Çì\n„Ç´„É¨„Éº" }, { name: "„Çø„Éñ 2", content: "" }, { name: "„Çø„Éñ 3", content: "" }, { name: "„Çø„Éñ 4", content: "" }, { name: "„Çø„Éñ 5", content: "" } ];
let curTabIdx = 0;
let globalVol = 0.5;

window.onload = () => { loadFromUrl(); renderTabs(); syncTab(); initBg(); };

// „Äê„Åì„Åì„ÅåÈáçË¶Å„Äë„Éá„Éº„Çø„ÇíÂúßÁ∏Æ„Åó„Å¶URL„ÇíÁü≠„Åè„Åô„ÇãÈñ¢Êï∞
function copyCompressedUrl() {
    const data = JSON.stringify({t: tabs, c: curTabIdx});
    const compressed = LZString.compressToEncodedURIComponent(data);
    // Ë≠òÂà•Â≠ê "z" „Çí‰ªò„Åë„Å¶URL‰ΩúÊàê
    const url = window.location.origin + window.location.pathname + "#z" + compressed;
    
    navigator.clipboard.writeText(url).then(() => {
        alert("Áü≠Á∏ÆÁî®„ÅÆÊúÄÁü≠URL„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅüîó\n„Åì„ÅÆ„Åæ„ÅæÁü≠Á∏Æ„Çµ„Ç§„Éà„Å´Ë≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
    });
}

// „Äê„Åì„Åì„ÅåÈáçË¶Å„ÄëÂúßÁ∏Æ„Åï„Çå„ÅüURL„ÇíËß£Âáç„Åó„Å¶Ë™≠„ÅøËæº„ÇÄÈñ¢Êï∞
function loadFromUrl() {
    const hash = window.location.hash.slice(1);
    if (!hash) return;
    try {
        let json;
        if (hash.startsWith('z')) {
            json = LZString.decompressFromEncodedURIComponent(hash.slice(1));
        } else {
            // ÊóßÂΩ¢Âºè„ÅÆ„Çµ„Éù„Éº„Éà
            json = decodeURIComponent(atob(hash));
        }
        const d = JSON.parse(json);
        tabs = d.t; curTabIdx = d.c;
    } catch(e) { console.error("Load error"); }
}

function syncTab() { document.getElementById('itemsArea').value = tabs[curTabIdx].content; updateItems(); }
function updateItems() {
    items = document.getElementById('itemsArea').value.split('\n').filter(t => t.trim() !== "");
    tabs[curTabIdx].content = document.getElementById('itemsArea').value;
    drawRoulette();
}
document.getElementById('itemsArea').addEventListener('input', updateItems);

function drawRoulette(offset = 0) {
    const cvs = document.getElementById('rCvs'), ctx = cvs.getContext('2d'), r = cvs.width / 2;
    ctx.clearRect(0,0,cvs.width,cvs.height);
    if(items.length === 0) return;
    const arc = (Math.PI*2) / items.length;
    items.forEach((txt, i) => {
        const ang = offset + (i * arc);
        ctx.beginPath(); ctx.moveTo(r,r); ctx.arc(r,r,r-5,ang,ang+arc);
        ctx.fillStyle = COLORS[i % COLORS.length]; ctx.fill();
        ctx.save(); ctx.translate(r,r); ctx.rotate(ang + arc/2);
        ctx.textAlign="right"; ctx.fillStyle="#333"; ctx.font="bold 14px sans-serif";
        ctx.fillText(txt.slice(0,8), r-20, 5); ctx.restore();
    });
}

function spin() {
    if(spinning || items.length === 0) return;
    spinning = true;
    const winIdx = Math.floor(Math.random() * items.length);
    const rotations = 8 + Math.random() * 5;
    const targetAng = (rotations * Math.PI * 2) + (1.5 * Math.PI - (winIdx * ((Math.PI*2)/items.length)) - ((Math.PI*2)/items.length / 2));
    const start = performance.now();
    const duration = 4000;
    function animate(now) {
        const prog = Math.min((now - start) / duration, 1);
        const ease = 1 - Math.pow(1 - prog, 3);
        drawRoulette(targetAng * ease);
        if (prog < 1) requestAnimationFrame(animate);
        else {
            spinning = false;
            document.getElementById('resText').innerText = items[winIdx];
            hist.unshift(items[winIdx]); renderHist();
        }
    }
    requestAnimationFrame(animate);
}

function renderTabs() {
    const d = document.getElementById('tabs'); d.innerHTML = "";
    tabs.forEach((t,i) => {
        const div = document.createElement('div');
        div.className = `tab-item ${i===curTabIdx?'active':''}`;
        div.innerHTML = `<span onclick="setTab(${i})">${t.name}</span>`;
        d.appendChild(div);
    });
}
function setTab(i) { curTabIdx=i; renderTabs(); syncTab(); }
function renderHist() {
    const u = document.getElementById('histUl'); u.innerHTML="";
    hist.slice(0,10).forEach(h => { const li=document.createElement('li'); li.innerText=h; u.appendChild(li); });
}
function hardReset() { if(confirm("Ê∂à„ÅôÔºü")){ tabs[curTabIdx].content=""; syncTab(); } }
function initBg() {
    const c = document.getElementById('bgCanvas'), ctx = c.getContext('2d');
    c.width = window.innerWidth; c.height = window.innerHeight;
    function draw() {
        ctx.clearRect(0,0,c.width,c.height);
        ctx.fillStyle = "rgba(200,220,255,0.1)";
        ctx.beginPath(); ctx.arc(100, 100, 50, 0, Math.PI*2); ctx.fill();
        requestAnimationFrame(draw);
    }
    draw();
}
function dropBall() {
    const b = document.getElementById('volBall'); b.style.display="block"; b.style.top="0";
    let y=0; const itv = setInterval(()=>{
        y+=5; b.style.top = y+"px";
        if(y>60){ clearInterval(itv); globalVol = Math.random(); document.getElementById('volText').innerText = Math.round(globalVol*100)+"%"; }
    }, 20);
}
</script>
</body>
</html>
