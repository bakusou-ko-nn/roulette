<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç©¶æ¥µã®ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>
<style>
  :root {
    --bg-white: #ffffff;
    --pastel-blue: #e0f7fa;
    --vivid-blue: #4ECDC4;
    --active-tab: #b2dfdb; /* è–„ã„é’ç·‘ */
    --vivid-red: #FF6B6B;
    --border-white: #ffffff;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    background-color: var(--bg-white);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }

  /* æœ€èƒŒé¢ï¼šå¹¾ä½•å­¦æ¨¡æ§˜ */
  #geo-bg {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    z-index: -1;
    pointer-events: none;
  }

  /* 16:9 ã£ã½ã„ãƒ¡ã‚¤ãƒ³å®¹å™¨ */
  #main-container {
    display: flex;
    width: 95vw;
    height: 85vh;
    max-width: 1400px;
    position: relative;
    gap: 20px;
  }

  /* å·¦å´ï¼šã‚¿ãƒ–ã‚¨ãƒªã‚¢ (1/4) */
  #left-area {
    width: 20%;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    padding-top: 20px;
  }

  .tab-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .tab-item {
    background: #f0f0f0;
    border: 2px solid var(--vivid-blue);
    padding: 15px;
    border-radius: 15px 0 0 15px;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
    display: flex;
    justify-content: space-between;
  }

  .tab-item.active {
    background: var(--active-tab);
    border-radius: 15px; /* é¸æŠä¸­ã¯ä¸¸ã */
  }

  /* å·¦ä¸‹ï¼šéŸ³é‡ã¨URL */
  #left-bottom {
    margin-top: auto;
    background: rgba(255,255,255,0.8);
    padding: 15px;
    border-radius: 15px;
  }

  #vol-slider-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100px;
    margin-bottom: 10px;
  }

  input[type="range"] {
    writing-mode: bt-lr; /* ç¸¦å‘ã */
    -webkit-appearance: slider-vertical;
    width: 8px;
    height: 80px;
  }

  /* ä¸­å¤®ï¼šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæœ¬ä½“ */
  #center-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  #wheel-wrapper {
    position: relative;
    cursor: pointer;
  }

  canvas#wheel {
    background: transparent;
  }

  #start-hint {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    font-weight: bold;
    color: rgba(0,0,0,0.2);
    pointer-events: none;
  }

  /* ä¸‹ã®åˆ¤å®šâ–² */
  #indicator {
    position: absolute;
    bottom: -15px;
    left: 50%;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 30px solid var(--vivid-red);
    z-index: 10;
  }

  /* å½“ãŸã£ãŸæ–‡å­—ï¼šã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼ä»˜ã */
  #result-text {
    margin-top: 20px;
    font-size: 48px;
    font-weight: 800;
    color: #333;
    text-decoration: underline 6px var(--vivid-red);
    min-height: 60px;
    z-index: 10;
  }

  /* å³å´ï¼šå±¥æ­´ (æ–‡å­—å¤§ãã‚) */
  #right-area {
    width: 25%;
    display: flex;
    flex-direction: column;
    padding-top: 20px;
  }

  #history-box {
    border: 3px solid var(--vivid-red);
    border-radius: 20px;
    height: 90%;
    background: #fff;
    padding: 20px;
    overflow-y: auto;
  }

  #history-list {
    font-size: 24px;
    font-weight: bold;
    list-style: none;
    padding: 0;
  }

  #history-list li {
    padding: 10px 0;
    border-bottom: 1px solid #eee;
  }

  /* å…¥åŠ›æ¬„ï¼ˆä¸‹å´ã«é…ç½®ï¼‰ */
  #input-container {
    position: absolute;
    bottom: -20px;
    width: 100%;
    display: flex;
    justify-content: center;
  }

  textarea {
    width: 60%;
    height: 80px;
    border-radius: 15px;
    padding: 10px;
    font-size: 16px;
    border: 2px solid #ddd;
  }

  button.vivid-btn {
    background: var(--vivid-blue);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 10px;
    cursor: pointer;
  }

</style>
</head>
<body>

<canvas id="geo-bg"></canvas>

<div id="main-container">
  <div id="left-area">
    <div id="vol-slider-container">
      <span id="vol-label">å¤§</span>
      <input type="range" id="vol-slider" min="0" max="1" step="0.1" value="0.5">
      <span>å°</span>
    </div>
    <div class="tab-list" id="tab-list"></div>
    
    <div id="left-bottom">
      <button class="vivid-btn" onclick="generateURL()">ğŸ”— URLç™ºè¡Œ</button>
      <div id="url-output" style="font-size:10px; margin-top:5px; word-break:break-all;"></div>
    </div>
  </div>

  <div id="center-area">
    <div id="wheel-wrapper" onclick="startSpin()">
      <canvas id="wheel" width="500" height="500"></canvas>
      <div id="start-hint">æŠ½é¸é–‹å§‹</div>
      <div id="indicator"></div>
    </div>
    <div id="result-text"></div>
    
    <div id="input-container">
      <textarea id="item-input" placeholder="æ”¹è¡Œã§é …ç›®è¿½åŠ ..."></textarea>
    </div>
  </div>

  <div id="right-area">
    <div id="history-box">
      <div style="text-align:center; color:var(--vivid-red); font-weight:bold;">å±¥æ­´</div>
      <ul id="history-list"></ul>
    </div>
  </div>
</div>

<script>
  // --- çŠ¶æ…‹ç®¡ç† ---
  let state = {
    tabs: [{ name: "ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ1", items: ["A", "B", "C"] }],
    activeTab: 0,
    history: [],
    angle: 0,
    isSpinning: false,
    volume: 0.5
  };

  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');
  const colors = ["#FFB3BA", "#FFDFBA", "#FFFFBA", "#BAFFC9", "#BAE1FF", "#E2F0CB"];
  const input = document.getElementById('item-input');

  // --- åˆæœŸåŒ– ---
  function init() {
    renderTabs();
    input.value = state.tabs[state.activeTab].items.join('\n');
    drawWheel();
    animateBG();
  }

  // --- ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæç”» ---
  function drawWheel(hitIndex = -1) {
    const items = state.tabs[state.activeTab].items;
    const cx = 250, cy = 250, r = 230;
    ctx.clearRect(0, 0, 500, 500);

    const step = (Math.PI * 2) / items.length;
    items.forEach((text, i) => {
      const s = state.angle + i * step;
      const e = s + step;
      ctx.beginPath();
      ctx.moveTo(cx, cy);
      ctx.arc(cx, cy, r, s, e);
      ctx.fillStyle = (i === hitIndex) ? "#FF0055" : colors[i % colors.length]; // å½“ãŸã‚Šã¯ãƒ“ãƒ“ãƒƒãƒˆ
      ctx.fill();
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 4;
      ctx.stroke();

      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(s + step / 2);
      ctx.fillStyle = "#333";
      ctx.font = "bold 20px sans-serif";
      ctx.fillText(text, r - 80, 5);
      ctx.restore();
    });

    // ä¸­å¿ƒ
    ctx.beginPath();
    ctx.arc(cx, cy, 30, 0, Math.PI * 2);
    ctx.fillStyle = "#fff";
    ctx.fill();
  }

  // --- éŸ³å£°ç”Ÿæˆ (AudioContext) ---
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function playSound(type) {
    if (state.volume === 0) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    
    if (type === 'roll') {
      osc.type = 'sawtooth';
      osc.frequency.setValueAtTime(100, audioCtx.currentTime);
      gain.gain.setValueAtTime(state.volume * 0.1, audioCtx.currentTime);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.1);
    } else {
      // ã±ã±ãƒ¼ã‚“
      osc.type = 'triangle';
      osc.frequency.setValueAtTime(523, audioCtx.currentTime);
      gain.gain.setValueAtTime(state.volume, audioCtx.currentTime);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.5);
    }
  }

  // --- å›è»¢ãƒ­ã‚¸ãƒƒã‚¯ ---
  function startSpin() {
    if (state.isSpinning || state.tabs[state.activeTab].items.length < 2) return;
    state.isSpinning = true;
    document.getElementById('start-hint').style.opacity = 0;
    let speed = Math.random() * 0.4 + 0.3;
    
    function loop() {
      state.angle += speed;
      speed *= 0.985;
      playSound('roll');
      if (speed < 0.005) {
        state.isSpinning = false;
        finishSpin();
        return;
      }
      drawWheel();
      requestAnimationFrame(loop);
    }
    loop();
  }

  function finishSpin() {
    const items = state.tabs[state.activeTab].items;
    const step = (Math.PI * 2) / items.length;
    // ä¸‹ã®åˆ¤å®š (PI/2)
    const pointer = (Math.PI / 2 - state.angle % (Math.PI * 2) + Math.PI * 2) % (Math.PI * 2);
    const hit = Math.floor(pointer / step);
    
    drawWheel(hit);
    const winner = items[hit];
    document.getElementById('result-text').textContent = winner;
    playSound('fanfare');
    addHistory(winner);
    explode();
  }

  // --- å±¥æ­´ ---
  function addHistory(val) {
    state.history.unshift(val);
    if (state.history.length > 20) state.history.pop();
    const list = document.getElementById('history-list');
    list.innerHTML = state.history.map(h => `<li>${h}</li>`).join('');
  }

  // --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ---
  function renderTabs() {
    const container = document.getElementById('tab-list');
    container.innerHTML = state.tabs.map((t, i) => `
      <div class="tab-item ${i === state.activeTab ? 'active' : ''}" onclick="switchTab(${i})">
        ${t.name}
      </div>
    `).join('');
  }

  function switchTab(idx) {
    state.activeTab = idx;
    input.value = state.tabs[idx].items.join('\n');
    renderTabs();
    drawWheel();
  }

  // --- å…¥åŠ›é€£å‹• ---
  input.addEventListener('input', () => {
    state.tabs[state.activeTab].items = input.value.split('\n').filter(v => v.trim() !== '');
    drawWheel();
  });

  // --- URLç™ºè¡Œ ---
  function generateURL() {
    const data = btoa(encodeURIComponent(JSON.stringify(state.tabs)));
    const url = window.location.origin + window.location.pathname + "?d=" + data;
    document.getElementById('url-output').innerHTML = `
      ${url} <button onclick="navigator.clipboard.writeText('${url}')">ã‚³ãƒ”ãƒ¼</button>
    `;
  }

  // --- çˆ†ç™ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆ & èƒŒæ™¯ ---
  const bgCanvas = document.getElementById('geo-bg');
  const bgCtx = bgCanvas.getContext('2d');
  function animateBG() {
    bgCanvas.width = window.innerWidth;
    bgCanvas.height = window.innerHeight;
    // å¹¾ä½•å­¦æ¨¡æ§˜ã‚’è–„ãæç”»ï¼ˆé™çš„ï¼‰
    for(let i=0; i<10; i++) {
      bgCtx.fillStyle = "rgba(200,200,200,0.1)";
      bgCtx.beginPath();
      bgCtx.fillRect(Math.random()*innerWidth, Math.random()*innerHeight, 30, 30);
    }
  }

  function explode() {
    // ç°¡æ˜“çš„ãªçˆ†ç™ºæ¼”å‡ºï¼ˆå®Ÿéš›ã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«JSãªã©ã‚’ä½¿ã†ãŒã“ã“ã§ã¯CSS/Canvasã§ä»£ç”¨ï¼‰
    console.log("ãƒ‘ãƒ‘ãƒ¼ãƒ³ï¼çˆ†ç™ºæ¼”å‡º");
  }

  init();
</script>

</body>
</html>
