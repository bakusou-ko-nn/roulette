<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‹å‘½ã®ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ</title>
    <style>
        :root {
            --bg-grad: radial-gradient(circle, #ffffff 0%, #f0f2f5 100%);
            --text-color: #333;
            --p-red: #ffb3ba; --p-yellow: #ffffba; --p-orange: #ffdfba;
            --p-blue: #bae1ff; --p-purple: #e2baff; --p-green: #baffc9;
            --p-gray: #e0e0e0; --mint-active: #b2ffb2; --border-deep: #4a90e2;
        }
        * { box-sizing: border-box; }
        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
            margin: 0; padding: 0; background: var(--bg-grad); color: var(--text-color);
            overflow: hidden; height: 100vh; display: flex; justify-content: center; align-items: center;
            transition: background 0.8s ease;
        }
        #bgCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .container { display: grid; grid-template-columns: 240px 1fr 240px; gap: 40px; width: 95%; max-width: 1300px; height: 85vh; position: relative; z-index: 1; }
        
        /* å·¦ãƒ‘ãƒãƒ«ï¼šéŸ³é‡ã¨ã‚¿ãƒ– */
        .left-panel { display: flex; flex-direction: column; gap: 20px; justify-content: center; }
        .audio-box { border: 1px solid #ddd; padding: 15px; border-radius: 15px; background: rgba(255, 255, 255, 0.9); text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .vol-game { position: relative; height: 70px; border-bottom: 3px solid #ccc; margin-bottom: 10px; background: #fff; overflow: hidden; border-radius: 5px; }
        #volBall { width: 18px; height: 18px; background: #ff6b6b; border-radius: 50%; position: absolute; top: 0; left: 50%; display: none; }
        .vol-info { font-size: 11px; color: #888; margin-bottom: 5px; }
        #volText { font-weight: bold; color: #4a90e2; font-size: 16px; }

        .tabs { display: flex; flex-direction: column; gap: 8px; }
        .tab-item { padding: 12px; border: 1px solid #eee; background: white; cursor: pointer; border-radius: 10px; transition: 0.3s; display: flex; justify-content: space-between; font-size: 13px; }
        .tab-item.active { background-color: var(--mint-active); border-color: transparent; font-weight: bold; transform: scale(1.05); }
        .sys-btns { display: flex; flex-direction: column; gap: 8px; }
        button { padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:active { transform: scale(0.95); }

        /* ä¸­å¤®ãƒ‘ãƒãƒ«ï¼šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæœ¬ä½“ */
        .center-panel { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .res-display { font-size: 32px; font-weight: bold; margin-bottom: 15px; height: 45px; text-align: center; color: #333; }
        .r-wrap { position: relative; margin-bottom: 20px; }
        .needle { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 40px; z-index: 10; text-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        canvas#rCvs { border-radius: 50%; box-shadow: 0 10px 40px rgba(0,0,0,0.08); background: white; }
        #spinBtn { width: 220px; height: 60px; font-size: 24px; background: #66cc66; color: white; border-bottom: 5px solid #44aa44; margin-bottom: 15px; }
        textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 10px; font-size: 14px; background: rgba(255,255,255,0.8); resize: none; }

        /* å³ãƒ‘ãƒãƒ«ï¼šå±¥æ­´ */
        .right-panel { display: flex; flex-direction: column; justify-content: center; }
        .hist-card { border: 1px solid #eee; border-radius: 20px; padding: 15px; height: 70%; background: rgba(255, 255, 255, 0.9); display: flex; flex-direction: column; box-shadow: 0 4px 15px rgba(0,0,0,0.02); }
        .hist-title { text-align: center; color: #888; font-size: 12px; margin-bottom: 10px; border-bottom: 1px solid #eee; }
        .hist-list { list-style: none; padding: 0; overflow-y: auto; flex: 1; margin: 0; }
        .hist-list li { padding: 8px; border-bottom: 1px solid #f9f9f9; font-size: 14px; text-align: center; }

        /* ã‚«ã‚ªã‚¹æ¼”å‡ºç”¨CSS */
        .c-dark { filter: invert(1) hue-rotate(180deg); background: #000 !important; }
        .c-pixel { image-rendering: pixelated; transform: scale(0.1) rotate(720deg); transition: 5s; }
        .c-fall { transform: translateY(150vh) rotate(45deg); transition: 1.5s ease-in; }
        .c-ghost { opacity: 0.1; }
        #fakeAd { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; padding: 20px; background: #fff000; border: 5px solid red; z-index: 999; display: none; text-align: center; }
        #modalHell { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: none; justify-content: center; align-items: center; }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="container">
    <div class="left-panel">
        <div class="audio-box">
            <div class="vol-info">VOL: <span id="volText">50%</span></div>
            <div class="vol-game" id="volGame"><div id="volBall"></div></div>
            <button onclick="dropBall()" style="background:#f0f0f0; width:100%;">ğŸ”Š éŸ³é‡æŠ½é¸</button>
            <button onclick="toggleMute()" id="muteBtn" style="background:#f0f0f0; width:100%; margin-top:5px;">ğŸ”‡ Mute: OFF</button>
        </div>
        <div class="tabs" id="tabs"></div>
        <div class="sys-btns">
            <button onclick="copyUrl()" style="background:var(--p-blue)">ğŸ”— ä¿å­˜ãƒ»URLã‚³ãƒ”ãƒ¼</button>
            <button onclick="hardReset()" style="background:var(--p-red)">âš ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
            <button onclick="undo()" style="background:var(--p-yellow); font-size:11px;">â†©ï¸ æˆ»ã™(Undo)</button>
        </div>
    </div>

    <div class="center-panel">
        <div class="res-display" id="resText">READY</div>
        <div class="r-wrap" id="rWrap">
            <div class="needle">â–¼</div>
            <canvas id="rCvs" width="380" height="380"></canvas>
        </div>
        <button id="spinBtn" onclick="spin()">START</button>
        <textarea id="itemsArea" placeholder="é …ç›®ã‚’æ”¹è¡Œã§å…¥åŠ›..."></textarea>
    </div>

    <div class="right-panel">
        <div class="hist-card">
            <div class="hist-title">HISTORY</div>
            <ul class="hist-list" id="histUl"></ul>
        </div>
    </div>
</div>

<div id="fakeAd"><b>âš ï¸é‡è¦ãªãŠçŸ¥ã‚‰ã›âš ï¸</b><p>ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼<br>ã‚ãªãŸã¯100ä¸‡äººç›®ã®è¨ªå•è€…ã§ã™</p><button onclick="this.parentElement.style.display='none'">å—ã‘å–ã‚‹</button></div>
<div id="modalHell"><div style="background:white; padding:40px; border-radius:20px; text-align:center;"><p id="mMsg" style="font-size:20px; font-weight:bold;">æº–å‚™ã¯ã„ã„ã§ã™ã‹ï¼Ÿ</p><button onclick="nextM()" style="font-size:18px; padding:10px 30px; background:red; color:white;">ã¯ã„</button></div></div>

<script>
const COLORS = ['#ffb3ba', '#ffffba', '#ffdfba', '#bae1ff', '#e2baff', '#baffc9', '#e0e0e0'];
let items = [], hist = [], prevStr = "", spinning = false, currentCType = null, bgm = null;
let tabs = [ { name: "ã‚¿ãƒ– 1", content: "ç„¼è‚‰\nå¯¿å¸\nã†ã©ã‚“\nã‚«ãƒ¬ãƒ¼" }, { name: "ã‚¿ãƒ– 2", content: "" }, { name: "ã‚¿ãƒ– 3", content: "" }, { name: "ã‚¿ãƒ– 4", content: "" }, { name: "ã‚¿ãƒ– 5", content: "" } ];
let curTabIdx = 0;
let globalVol = 0.5; // éŸ³é‡ã‚­ãƒ¼ãƒ—ç”¨
let isMuted = false;

window.onload = () => { loadHash(); renderTabs(); syncTab(); initBg(); updateVolDisp(); };

function syncTab() { document.getElementById('itemsArea').value = tabs[curTabIdx].content; updateItems(); }
function updateItems() {
    items = document.getElementById('itemsArea').value.split('\n').filter(t => t.trim() !== "").slice(0, 500);
    tabs[curTabIdx].content = document.getElementById('itemsArea').value;
    drawRoulette();
}
document.getElementById('itemsArea').addEventListener('input', updateItems);

function drawRoulette(offset = 0) {
    const cvs = document.getElementById('rCvs'), ctx = cvs.getContext('2d'), r = cvs.width / 2;
    ctx.clearRect(0,0,cvs.width,cvs.height);
    ctx.beginPath(); ctx.arc(r,r,r-5,0,7); ctx.fillStyle="#fff"; ctx.fill();
    ctx.lineWidth=4; ctx.strokeStyle="#eee"; ctx.stroke();
    if(items.length === 0) return;
    const arc = (Math.PI*2) / items.length;
    items.forEach((txt, i) => {
        const ang = offset + (i * arc);
        ctx.beginPath(); ctx.moveTo(r,r); ctx.arc(r,r,r-8,ang,ang+arc);
        ctx.fillStyle = COLORS[i % COLORS.length]; ctx.fill();
        ctx.save(); ctx.translate(r,r); ctx.rotate(ang + arc/2); ctx.textAlign="right"; ctx.fillStyle="#333";
        ctx.font="bold 15px sans-serif"; ctx.fillText(txt.length > 9 ? txt.slice(0,8)+'..' : txt, r-25, 5); ctx.restore();
    });
}

// éŸ³é‡ã‚­ãƒ¼ãƒ—
function dropBall() {
    const b = document.getElementById('volBall'); b.style.display="block"; b.style.top="0";
    b.style.left = Math.random() * 80 + 10 + "%";
    let y=0, speed=1;
    const itv = setInterval(()=>{
        y+=speed; speed+=0.8; b.style.top=y+'px';
        if(y>60) { 
            clearInterval(itv); 
            globalVol = Math.random(); 
            updateVolDisp();
            playS('win'); // ç¢ºèªéŸ³
        }
    },20);
}
function updateVolDisp() { document.getElementById('volText').innerText = Math.round(globalVol * 100) + "%"; }
function toggleMute() { isMuted = !isMuted; document.getElementById('muteBtn').innerText = isMuted ? "ğŸ”‡ Mute: ON" : "ğŸ”‡ Mute: OFF"; }

// éŸ³å£°å†ç”Ÿï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤æ©Ÿèƒ½ä»˜ãï¼‰
function playS(type) {
    if(isMuted) return;
    const vol = globalVol;

    if(type === 'roll') {
        if(bgm) bgm.pause();
        bgm = new Audio("https://soundeffect-lab.info/sound/anime/mp3/tympani-roll1.mp3");
        bgm.loop = true; bgm.volume = vol;
        bgm.play().catch(e => console.log("Audio block active"));
    } else {
        if(bgm) { bgm.pause(); bgm = null; }
        const jean = "https://soundeffect-lab.info/sound/anime/mp3/jean1.mp3";
        const alt = ["https://soundeffect-lab.info/sound/anime/mp3/trumpet2.mp3","https://soundeffect-lab.info/sound/anime/mp3/shine3.mp3"];
        const a = new Audio((Math.random() < 0.8) ? jean : alt[Math.floor(Math.random()*alt.length)]);
        a.volume = vol;
        a.play().catch(()=>{});
    }
}

// ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ”ãƒ³
async function spin() {
    if(spinning || items.length === 0) return;

    // â˜…ãƒ–ãƒ©ã‚¦ã‚¶éŸ³å£°è§£æ”¾â˜…
    const unlock = new Audio(); unlock.play().then(()=>unlock.pause()).catch(()=>{});

    prevStr = tabs[curTabIdx].content;
    const isChaos = Math.random() < 0.2;
    currentCType = isChaos ? ['modal','ad','pixel','invert','fall','invisible','mojibake'][Math.floor(Math.random()*7)] : null;

    resetStyles();
    if(currentCType === 'modal') await startModalHell();
    if(currentCType === 'ad') document.getElementById('fakeAd').style.display = 'block';

    spinning = true;
    playS('roll');

    // å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ãªå½“é¸è€…ã®æ±ºå®š
    const winIdx = Math.floor(Math.random() * items.length);
    const arc = (Math.PI*2) / items.length;
    const rotations = 7 + Math.random() * 5; 
    const targetAng = (rotations * Math.PI * 2) + (1.5 * Math.PI - (winIdx * arc) - (arc / 2));
    
    let currentAng = 0;
    const start = performance.now();
    const duration = 5000;

    if(currentCType === 'invisible') document.getElementById('rCvs').classList.add('c-ghost');

    function animate(now) {
        const elapsed = now - start;
        const progress = Math.min(elapsed / duration, 1);
        const ease = 1 - Math.pow(1 - progress, 3); // Cubic ease-out
        currentAng = targetAng * ease;
        drawRoulette(currentAng);
        if (progress < 1) requestAnimationFrame(animate);
        else finalizeSpin(winIdx);
    }
    requestAnimationFrame(animate);
}

function finalizeSpin(winIdx) {
    spinning = false;
    let winItem = items[winIdx];
    if(currentCType === 'mojibake') winItem = "D@SI";
    if(currentCType === 'pixel') document.getElementById('rWrap').classList.add('c-pixel');
    if(currentCType === 'invert') document.body.classList.add('c-dark');
    if(currentCType === 'fall') document.getElementById('rWrap').classList.add('c-fall');

    document.getElementById('resText').innerText = winItem;
    document.body.style.background = COLORS[winIdx % COLORS.length];
    playS('win');
    if(currentCType !== 'mojibake') { hist.unshift(winItem); if(hist.length>10) hist.pop(); renderHist(); }
}

// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
function renderTabs() {
    const d = document.getElementById('tabs'); d.innerHTML = "";
    tabs.forEach((t,i) => {
        const div = document.createElement('div');
        div.className = `tab-item ${i===curTabIdx?'active':''}`;
        div.innerHTML = `<span onclick="setTab(${i})">${t.name}</span><span style="opacity:0.3; font-size:10px;" onclick="renTab(${i})">ç·¨é›†</span>`;
        d.appendChild(div);
    });
}
function setTab(i) { curTabIdx=i; renderTabs(); syncTab(); }
function renTab(i) { const n=prompt("åå‰:", tabs[i].name); if(n){tabs[i].name=n; renderTabs();} }
function renderHist() { const u = document.getElementById('histUl'); u.innerHTML=""; hist.forEach(h => { const l=document.createElement('li'); l.innerText=h; u.appendChild(l); }); }
function hardReset() { if(confirm("å…¨éƒ¨æ¶ˆã™ã‚ˆï¼Ÿ")){ tabs[curTabIdx].content=""; syncTab(); resetStyles(); } }
function undo() { if(prevStr){ tabs[curTabIdx].content=prevStr; syncTab(); } }
function resetStyles() {
    const w = document.getElementById('rWrap'); w.className="r-wrap";
    document.getElementById('rCvs').className=""; document.body.classList.remove('c-dark');
    document.getElementById('fakeAd').style.display="none"; document.body.style.background = "var(--bg-grad)";
}
let mCount=0;
function startModalHell() {
    return new Promise(res => {
        mCount=0; document.getElementById('modalHell').style.display='flex';
        window.nextM = () => { mCount++; document.getElementById('mMsg').innerText="æœ¬å½“ã«ã„ã„ã§ã™ã‹ï¼Ÿ(" + mCount + "/5)"; if(mCount>=5){ document.getElementById('modalHell').style.display='none'; res(); } };
    });
}
function copyUrl() {
    const b64 = btoa(encodeURIComponent(JSON.stringify({t:tabs, c:curTabIdx})));
    window.location.hash = b64; navigator.clipboard.writeText(window.location.href); alert("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ã©ã“ã‹ã«è²¼ã£ã¦ä¿å­˜ã—ã¦ã­ğŸ”—");
}
function loadHash() { try { if(window.location.hash){ const d = JSON.parse(decodeURIComponent(atob(window.location.hash.slice(1)))); tabs=d.t; curTabIdx=d.c; } } catch(e){} }

// èƒŒæ™¯ã‚¢ãƒ‹ãƒ¡
let shapes = [];
function initBg() {
    const c = document.getElementById('bgCanvas'); c.width = window.innerWidth; c.height = window.innerHeight;
    for(let i=0; i<30; i++) shapes.push({ x: Math.random()*c.width, y: Math.random()*c.height, s: Math.random()*15+5, sp: Math.random()*0.5+0.1, col: COLORS[Math.floor(Math.random()*7)], t: Math.floor(Math.random()*3) });
    tick();
}
function tick() {
    const c = document.getElementById('bgCanvas'), ctx = c.getContext('2d');
    ctx.clearRect(0,0,c.width,c.height);
    shapes.forEach(p => {
        p.y += p.sp; if(p.y > c.height) p.y = -20;
        ctx.fillStyle = p.col; ctx.globalAlpha = 0.3; ctx.beginPath();
        if(p.t===0) ctx.arc(p.x, p.y, p.s, 0, 7);
        else if(p.t===1) ctx.fillRect(p.x, p.y, p.s, p.s);
        else { ctx.moveTo(p.x,p.y); ctx.lineTo(p.x+p.s, p.y+p.s); ctx.lineTo(p.x-p.s, p.y+p.s); }
        ctx.fill();
    });
    requestAnimationFrame(tick);
}
</script>
</body>
</html>
