<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Roulette</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
<style>
:root{--bg1:#fff;--bg2:#fff}
body{
  margin:0;min-height:100vh;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:linear-gradient(to bottom,var(--bg1),var(--bg2));
  overflow:hidden;
}
#geom{position:fixed;inset:0;pointer-events:none;}
.tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px}
.tab{padding:6px 12px;border-radius:999px;border:1px solid #ccc;background:#fff;cursor:pointer}
.tab.active{background:#333;color:#fff}
textarea{width:90vw;max-width:420px;height:120px;border-radius:12px;padding:10px;font-size:14px}
.controls{display:flex;gap:8px;margin:8px 0}
button{padding:10px 18px;border:none;border-radius:999px;background:#333;color:#fff;cursor:pointer}
#wheelWrap{position:relative}
canvas#wheel{width:360px;height:360px}
#arrow{font-size:28px;margin-top:-4px}
#result{font-family:'Montserrat',sans-serif;font-size:34px;font-weight:900;margin-top:6px;min-height:40px}
#history{position:fixed;right:12px;bottom:12px;background:#fff;border-radius:16px;padding:10px;width:160px;font-size:12px}
.history-item{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.color-chip{width:12px;height:12px;border-radius:50%}
</style>
</head>
<body>
<canvas id="geom"></canvas>

<div class="tabs" id="tabs"></div>
<textarea id="items" placeholder="‰æã:\n„É´„Éº„É¨„ÉÉ„Éà1\nA\nB\nC"></textarea>
<div class="controls">
  <button onclick="spin()">Âõû„Åô</button>
  <button onclick="resetAll()">„ÇÑ„ÇäÁõ¥„Åó</button>
  <button onclick="toggleSound()" id="soundBtn">üîä</button>
</div>
<div id="wheelWrap">
  <canvas id="wheel" width="360" height="360"></canvas>
</div>
<div id="arrow">‚ñ≤</div>
<div id="result"></div>
<div id="history"><strong>Â±•Ê≠¥</strong><div id="historyList"></div></div>
<audio id="tick" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>

<script>
// ===== Âπæ‰ΩïÂ≠¶Ê®°Êßò =====
const gcv=document.getElementById('geom'),gctx=gcv.getContext('2d');
let geoms=[];
function resizeGeom(){gcv.width=innerWidth;gcv.height=innerHeight}
addEventListener('resize',resizeGeom);resizeGeom();
function spawnGeom(){geoms.push({x:Math.random()*gcv.width,y:-20,size:6+Math.random()*10,speed:0.5+Math.random()*1.5,color:`hsl(${Math.random()*360},70%,80%)`,shape:Math.random()<.5?'c':'r'})}
function drawGeom(){gctx.clearRect(0,0,gcv.width,gcv.height);if(Math.random()<0.3)spawnGeom();geoms.forEach(o=>{gctx.fillStyle=o.color;if(o.shape==='c'){gctx.beginPath();gctx.arc(o.x,o.y,o.size,0,Math.PI*2);gctx.fill()}else{gctx.fillRect(o.x,o.y,o.size,o.size)}o.y+=o.speed});geoms=geoms.filter(o=>o.y<gcv.height+20);requestAnimationFrame(drawGeom)}drawGeom();

// ===== „É´„Éº„É¨„ÉÉ„Éà =====
const canvas=document.getElementById('wheel'),ctx=canvas.getContext('2d');
const colors=["#ffadad","#ffd6a5","#fdffb6","#caffbf","#9bf6ff","#a0c4ff","#bdb2ff"];
let angle=0,spinning=false,soundOn=true;
let history=[],activeTab=0;
const presets=JSON.parse(localStorage.getItem('presets')||'[]');

function parseItems(){
  const lines=document.getElementById('items').value.split("\n").filter(Boolean);
  if(lines.length<2) return {name:'',items:[]};
  return {name:lines[0],items:lines.slice(1)};
}

function draw(items){
  const r=canvas.width/2;ctx.clearRect(0,0,canvas.width,canvas.height);
  const step=2*Math.PI/items.length;
  items.forEach((t,i)=>{
    ctx.beginPath();ctx.moveTo(r,r);
    ctx.fillStyle=colors[i%colors.length];
    ctx.arc(r,r,r,i*step+angle,(i+1)*step+angle);ctx.fill();
    ctx.save();ctx.translate(r,r);ctx.rotate(i*step+step/2+angle);
    ctx.textAlign='right';ctx.fillStyle='#333';ctx.font='14px sans-serif';
    ctx.fillText(t,r-10,5);ctx.restore();
  });
}

function spin(){
  if(spinning) return;
  const parsed=parseItems();const items=parsed.items;if(items.length<2) return;
  spinning=true;let speed=0.35+Math.random()*0.25;
  const tick=document.getElementById('tick');
  const interval=setInterval(()=>{
    angle+=speed;speed*=0.985;draw(items);
    if(soundOn){tick.currentTime=0;tick.play()}
    if(speed<0.002){
      clearInterval(interval);spinning=false;
      // ‚ñ≤„ÅØ‰∏ãÔºù270Â∫¶ ‚Üí Â§ñÂë®„ÅåËß¶„Çå„Å¶„ÅÑ„Çã‰ΩçÁΩÆ„ÅßÂà§ÂÆö
      const pointerAngle=(1.5*Math.PI-angle%(2*Math.PI)+2*Math.PI)%(2*Math.PI);
      const idx=Math.floor(pointerAngle/(2*Math.PI/items.length))%items.length;
      const hit=items[idx],color=colors[idx%colors.length];
      document.getElementById('result').textContent=hit;
      document.body.style.setProperty('--bg1',color);
      document.body.style.setProperty('--bg2','#fff');
      history.unshift({hit,color});history=history.slice(0,10);renderHistory();
    }
  },16);
}

function renderHistory(){
  const h=document.getElementById('historyList');h.innerHTML='';
  history.forEach(i=>{const d=document.createElement('div');d.className='history-item';
    d.innerHTML=`<span class="color-chip" style="background:${i.color}"></span>${i.hit}`;
    h.appendChild(d)});
}

function resetAll(){document.getElementById('result').textContent='';history=[];renderHistory();document.body.style.setProperty('--bg1','#fff')}
function toggleSound(){soundOn=!soundOn;document.getElementById('soundBtn').textContent=soundOn?'üîä':'üîá'}

function renderTabs(){
  const t=document.getElementById('tabs');t.innerHTML='';
  for(let i=0;i<5;i++){
    const b=document.createElement('button');b.className='tab'+(i===activeTab?' active':'');
    b.textContent=presets[i]?.name||('Tab '+(i+1));
    b.onclick=()=>{
      presets[activeTab]={name:parseItems().name,raw:document.getElementById('items').value};
      activeTab=i;document.getElementById('items').value=presets[i]?.raw||'';
      localStorage.setItem('presets',JSON.stringify(presets));renderTabs();
    };t.appendChild(b);
  }
}
renderTabs();draw(['A','B','C']);
</script>
</body>
</html>
