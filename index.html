<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‹å‘½ã®ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ EX + ç¥ç ²</title>
    <style>
        :root {
            --bg-grad: linear-gradient(to bottom, #ffffff 0%, #f0f2f5 100%);
            --text-color: #333;
            --p-red: #ffb3ba; --p-yellow: #ffffba; --p-orange: #ffdfba;
            --p-blue: #bae1ff; --p-purple: #e2baff; --p-green: #baffc9;
            --mint-active: #b2ffb2;
        }
        * { box-sizing: border-box; }
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            margin: 0; padding: 0; background: var(--bg-grad); color: var(--text-color);
            overflow: hidden; height: 100vh; display: flex; justify-content: center; align-items: center;
            transition: background 1.2s ease;
        }
        #bgCanvas, #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        #confettiCanvas { z-index: 5; } /* ç´™å¹é›ªã¯ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã‚ˆã‚Šå‰é¢ã€UIã‚ˆã‚ŠèƒŒé¢ */
        
        .container { display: grid; grid-template-columns: 240px 1fr 240px; gap: 40px; width: 95%; max-width: 1300px; height: 85vh; position: relative; z-index: 10; }
        
        .left-panel { display: flex; flex-direction: column; gap: 20px; justify-content: center; }
        .audio-box { border: 1px solid #ddd; padding: 15px; border-radius: 15px; background: rgba(255, 255, 255, 0.9); text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .vol-game { position: relative; height: 70px; border-bottom: 3px solid #ccc; margin-bottom: 10px; background: #fff; overflow: hidden; border-radius: 5px; }
        #volBall { width: 18px; height: 18px; background: #ff6b6b; border-radius: 50%; position: absolute; top: 0; left: 50%; display: none; }
        #volText { font-weight: bold; color: #4a90e2; font-size: 16px; }

        .tabs { display: flex; flex-direction: column; gap: 8px; }
        .tab-item { padding: 12px; border: 1px solid #eee; background: white; cursor: pointer; border-radius: 10px; transition: 0.3s; display: flex; justify-content: space-between; font-size: 13px; }
        .tab-item.active { background-color: var(--mint-active); font-weight: bold; transform: scale(1.05); }
        
        .center-panel { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .res-display { font-size: 36px; font-weight: bold; margin-bottom: 15px; height: 50px; text-align: center; color: #333; text-shadow: 0 0 15px rgba(255,255,255,1); }
        .r-wrap { position: relative; margin-bottom: 20px; }
        .needle { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 40px; z-index: 20; color: #ff4444; }
        canvas#rCvs { border-radius: 50%; box-shadow: 0 10px 40px rgba(0,0,0,0.15); background: white; }
        
        #spinBtn { width: 220px; height: 60px; font-size: 24px; background: #66cc66; color: white; border: none; border-bottom: 5px solid #44aa44; border-radius: 10px; cursor: pointer; }
        textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 10px; background: rgba(255,255,255,0.85); resize: none; margin-top: 10px; }

        .hist-card { border: 1px solid #eee; border-radius: 20px; padding: 15px; height: 70%; background: rgba(255, 255, 255, 0.9); display: flex; flex-direction: column; }
        .hist-list { list-style: none; padding: 0; overflow-y: auto; flex: 1; margin: 0; font-size: 14px; text-align: center; }

        /* ç‰¹æ®Šæ¼”å‡º */
        .c-dark { filter: invert(1) hue-rotate(180deg); background: #000 !important; }
        #fakeAd { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px; background: #fff000; border: 5px solid red; z-index: 999; display: none; text-align: center; }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>
<canvas id="confettiCanvas"></canvas>

<div class="container">
    <div class="left-panel">
        <div class="audio-box">
            <div>VOL: <span id="volText">50%</span></div>
            <div class="vol-game" id="volGame"><div id="volBall"></div></div>
            <button onclick="dropBall()" style="width:100%;">ğŸ”Š éŸ³é‡æŠ½é¸</button>
        </div>
        <div class="tabs" id="tabs"></div>
        <button onclick="copyUrl()" style="background:var(--p-blue)">ğŸ”— ä¿å­˜ãƒ»URLã‚³ãƒ”ãƒ¼</button>
        <button onclick="hardReset()" style="background:var(--p-red)">âš ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <div class="center-panel">
        <div class="res-display" id="resText">READY</div>
        <div class="r-wrap" id="rWrap">
            <div class="needle">â–¼</div>
            <canvas id="rCvs" width="380" height="380"></canvas>
        </div>
        <button id="spinBtn" onclick="spin()">START</button>
        <textarea id="itemsArea" placeholder="é …ç›®ã‚’æ”¹è¡Œã§å…¥åŠ›..."></textarea>
    </div>

    <div class="right-panel">
        <div class="hist-card">
            <div style="text-align:center; color:#888; font-size:12px;">HISTORY</div>
            <ul class="hist-list" id="histUl"></ul>
        </div>
    </div>
</div>

<div id="fakeAd"><b>âš ï¸é‡è¦âš ï¸</b><p>100ä¸‡äººç›®ã®è¨ªå•è€…ã§ã™ï¼</p><button onclick="this.parentElement.style.display='none'">é–‰ã˜ã‚‹</button></div>

<script>
const COLORS = ['#ffb3ba', '#ffffba', '#ffdfba', '#bae1ff', '#e2baff', '#baffc9', '#ffccf9'];
let items = [], hist = [], spinning = false, globalVol = 0.5, bgm = null;
let tabs = [ { name: "ã‚¿ãƒ– 1", content: "å¤§å‰\nä¸­å‰\nå°å‰\nå‰\næœ«å‰\nå‡¶" }, { name: "ã‚¿ãƒ– 2", content: "" }, { name: "ã‚¿ãƒ– 3", content: "" }, { name: "ã‚¿ãƒ– 4", content: "" }, { name: "ã‚¿ãƒ– 5", content: "" } ];
let curTabIdx = 0;
let confettis = [];

window.onload = () => { renderTabs(); syncTab(); initBg(); updateVolDisp(); };

function syncTab() { document.getElementById('itemsArea').value = tabs[curTabIdx].content; updateItems(); }
function updateItems() {
    items = document.getElementById('itemsArea').value.split('\n').filter(t => t.trim() !== "");
    tabs[curTabIdx].content = document.getElementById('itemsArea').value;
    drawRoulette();
}
document.getElementById('itemsArea').addEventListener('input', updateItems);

function drawRoulette(offset = 0) {
    const cvs = document.getElementById('rCvs'), ctx = cvs.getContext('2d'), r = cvs.width / 2;
    ctx.clearRect(0,0,cvs.width,cvs.height);
    if(items.length === 0) return;
    const arc = (Math.PI*2) / items.length;
    items.forEach((txt, i) => {
        const ang = offset + (i * arc);
        ctx.beginPath(); ctx.moveTo(r,r); ctx.arc(r,r,r-8,ang,ang+arc);
        ctx.fillStyle = COLORS[i % COLORS.length]; ctx.fill();
        ctx.save(); ctx.translate(r,r); ctx.rotate(ang + arc/2); ctx.textAlign="right"; ctx.fillStyle="#333";
        ctx.font="bold 15px sans-serif"; ctx.fillText(txt.slice(0,9), r-25, 5); ctx.restore();
    });
}

function dropBall() {
    const b = document.getElementById('volBall'); b.style.display="block";
    let y=0, speed=1;
    const itv = setInterval(()=>{
        y+=speed; speed+=0.8; b.style.top=y+'px';
        if(y>60) { clearInterval(itv); globalVol = Math.random(); updateVolDisp(); }
    },20);
}
function updateVolDisp() { document.getElementById('volText').innerText = Math.round(globalVol * 100) + "%"; }

function playS(type) {
    const a = new Audio(type === 'roll' ? "https://soundeffect-lab.info/sound/anime/mp3/tympani-roll1.mp3" : "https://soundeffect-lab.info/sound/anime/mp3/jean1.mp3");
    a.volume = globalVol; if(type === 'roll') { bgm = a; a.loop = true; } a.play().catch(()=>{});
}

async function spin() {
    if(spinning || items.length === 0) return;
    spinning = true;
    playS('roll');
    const winIdx = Math.floor(Math.random() * items.length);
    const rotations = 8 + Math.random() * 5; 
    const targetAng = (rotations * Math.PI * 2) + (1.5 * Math.PI - (winIdx * (Math.PI*2/items.length)) - (Math.PI/items.length));
    let start = performance.now();
    function animate(now) {
        let progress = Math.min((now - start) / 5000, 1);
        drawRoulette(targetAng * (1 - Math.pow(1 - progress, 4)));
        if (progress < 1) requestAnimationFrame(animate);
        else finalizeSpin(winIdx);
    }
    requestAnimationFrame(animate);
}

function finalizeSpin(winIdx) {
    spinning = false; if(bgm) bgm.pause();
    const winItem = items[winIdx];
    const winColor = COLORS[winIdx % COLORS.length];
    document.getElementById('resText').innerText = winItem;
    document.body.style.background = `linear-gradient(to bottom, ${winColor} 0%, #ffffff 100%)`;
    playS('win');
    createConfetti(winColor); // ç´™å¹é›ªç”Ÿæˆï¼
    hist.unshift(winItem); renderHist();
}

// --- ç´™å¹é›ªã‚·ã‚¹ãƒ†ãƒ  ---
class Confetti {
    constructor(color) {
        this.x = window.innerWidth / 2;
        this.y = window.innerHeight / 2;
        this.size = Math.random() * 10 + 5;
        this.color = color;
        this.vx = (Math.random() - 0.5) * 20;
        this.vy = (Math.random() - 0.8) * 20;
        this.gravity = 0.3;
        this.rotation = Math.random() * 360;
        this.rSpeed = (Math.random() - 0.5) * 10;
        this.opacity = 1;
    }
    update() {
        this.x += this.vx; this.y += this.vy; this.vy += this.gravity;
        this.rotation += this.rSpeed; this.opacity -= 0.005;
    }
    draw(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation * Math.PI / 180);
        ctx.globalAlpha = this.opacity;
        ctx.fillStyle = this.color;
        ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
        ctx.restore();
    }
}

function createConfetti(color) {
    for(let i=0; i<100; i++) confettis.push(new Confetti(color));
}

// --- èƒŒæ™¯ãƒ»ãƒ«ãƒ¼ãƒ—å‡¦ç† ---
let shapes = [];
function initBg() {
    const c = document.getElementById('bgCanvas');
    const cc = document.getElementById('confettiCanvas');
    c.width = cc.width = window.innerWidth; c.height = cc.height = window.innerHeight;
    for(let i=0; i<40; i++) shapes.push({ x: Math.random()*c.width, y: Math.random()*c.height, s: Math.random()*20+10, sp: Math.random()*3+2, col: COLORS[Math.floor(Math.random()*7)], t: Math.floor(Math.random()*3) });
    loop();
}

function loop() {
    const c = document.getElementById('bgCanvas'), ctx = c.getContext('2d');
    const cc = document.getElementById('confettiCanvas'), cctx = cc.getContext('2d');
    ctx.clearRect(0,0,c.width,c.height);
    cctx.clearRect(0,0,cc.width,cc.height);

    // èƒŒæ™¯æ¨¡æ§˜
    shapes.forEach(p => {
        p.y += p.sp; if(p.y > c.height) p.y = -30;
        ctx.fillStyle = p.col; ctx.globalAlpha = 0.6; ctx.beginPath();
        if(p.t===0) ctx.arc(p.x, p.y, p.s/2, 0, 7);
        else if(p.t===1) ctx.fillRect(p.x, p.y, p.s, p.s);
        else { ctx.moveTo(p.x,p.y); ctx.lineTo(p.x+p.s, p.y+p.s); ctx.lineTo(p.x-p.s, p.y+p.s); ctx.closePath(); }
        ctx.fill();
    });

    // ç´™å¹é›ª
    confettis = confettis.filter(cf => cf.opacity > 0 && cf.y < cc.height);
    confettis.forEach(cf => { cf.update(); cf.draw(cctx); });

    requestAnimationFrame(loop);
}

function renderTabs() {
    const d = document.getElementById('tabs'); d.innerHTML = "";
    tabs.forEach((t,i) => {
        const div = document.createElement('div');
        div.className = `tab-item ${i===curTabIdx?'active':''}`;
        div.onclick = () => { curTabIdx=i; renderTabs(); syncTab(); };
        div.innerText = t.name; d.appendChild(div);
    });
}
function renderHist() { const u = document.getElementById('histUl'); u.innerHTML=""; hist.forEach(h => { const l=document.createElement('li'); l.innerText=h; u.appendChild(l); }); }
function hardReset() { if(confirm("æ¶ˆã™ã‚ˆï¼Ÿ")){ tabs[curTabIdx].content=""; syncTab(); } }
function copyUrl() { alert("URLã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ˆæ“¬ä¼¼ï¼‰"); }
</script>
</body>
</html>
